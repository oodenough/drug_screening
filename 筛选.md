ä½ æå‡ºäº†ä¸€ä¸ªéå¸¸æ·±åˆ»ä¸”ç›´è§‚çš„é—®é¢˜ã€‚ä»ä»£ç ä¸Šçœ‹ï¼Œè¿™ç¡®å®åƒæ˜¯åœ¨è·‘ä¸¤ä¸ªâ€œé¢„æµ‹å®éªŒâ€ï¼Œä½†**â€œç­›é€‰ï¼ˆScreeningï¼‰â€**çš„æœ¬è´¨åœ¨äº**ä»æµ·é‡å€™é€‰è€…ä¸­é€šè¿‡è¿‡æ»¤å’Œæ’åºï¼Œæ‰¾å‡ºæå°‘æ•°â€œä¼˜èƒœè€…â€çš„è¿‡ç¨‹**ã€‚

æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªç³»ç»Ÿæƒ³è±¡æˆä¸€ä¸ª**â€œæ™ºèƒ½ç­›å­â€**ã€‚ç›®å‰çš„è®­ç»ƒå’Œé¢„æµ‹åªæ˜¯åœ¨â€œåˆ¶é€ ç­›å­â€ï¼Œè€ŒçœŸæ­£çš„â€œç­›é€‰â€å‘ç”Ÿåœ¨**è™šæ‹Ÿç­›é€‰ï¼ˆVirtual Screeningï¼‰**é˜¶æ®µã€‚

ä»¥ä¸‹æ˜¯è¯¥ç³»ç»Ÿå¦‚ä½•å®ç°â€œç­›é€‰â€é€»è¾‘çš„è¯¦ç»†è§£å‰–ï¼š

------

## 1. è¯ç‰©å‘ç°çš„â€œæ¼æ–—â€æœºåˆ¶

åœ¨çœŸå®çš„è¯ç‰©ç ”å‘ä¸­ï¼Œç§‘å­¦å®¶é¢å¯¹çš„æ˜¯ $10^{60}$ ç§å¯èƒ½çš„åŒ–å­¦ç©ºé—´ã€‚ç­›é€‰ç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªâ€œæ•°å­—æ¼æ–—â€ï¼š

### ç­›é€‰çš„å…·ä½“æµç¨‹ï¼š

1. **è¾“å…¥å±‚ï¼ˆä¸‡çº§/äº¿çº§å€™é€‰åˆ†å­ï¼‰**ï¼šä½ å¯¼å…¥ä¸€ä¸ªåŒ…å« 10,000 ä¸ªæœªçŸ¥åˆ†å­çš„ `.csv` æ–‡ä»¶ã€‚
2. **ç¬¬ä¸€å±‚ç­›ç½‘ï¼ˆESOLæ¨¡å‹ - æº¶è§£åº¦ç­›é€‰ï¼‰**ï¼š
   - **é€»è¾‘**ï¼šè¯ç‰©å¦‚æœä¸æº¶äºæ°´ï¼Œå°±æ— æ³•è¢«å¸æ”¶ã€‚
   - **æ“ä½œ**ï¼šæ¨¡å‹å¯¹ 10,000 ä¸ªåˆ†å­æ‰“åˆ†ï¼Œå‰”é™¤æº¶è§£åº¦ä½äº $-4.0$ log mol/L çš„åˆ†å­ã€‚
   - **ç»“æœ**ï¼šå‰©ä¸‹ 2,000 ä¸ªåˆ†å­ã€‚
3. **ç¬¬äºŒå±‚ç­›ç½‘ï¼ˆBBBPæ¨¡å‹ - è¯æ•ˆç­›é€‰ï¼‰**ï¼š
   - **é€»è¾‘**ï¼šå¦‚æœä½ è¦ç ”å‘çš„æ˜¯è„‘éƒ¨ç¥ç»è¯ç‰©ï¼Œåˆ†å­å¿…é¡»èƒ½ç©¿é€è¡€è„‘å±éšœã€‚
   - **æ“ä½œ**ï¼šæ¨¡å‹å¯¹å‰©ä¸‹çš„ 2,000 ä¸ªåˆ†å­é¢„æµ‹ç©¿é€æ¦‚ç‡ $P$ã€‚
   - **ç»“æœ**ï¼šåªä¿ç•™ $P > 0.8$ çš„åˆ†å­ï¼Œå‰©ä¸‹ 150 ä¸ªåˆ†å­ã€‚
4. **ç¬¬ä¸‰å±‚ç­›ç½‘ï¼ˆADMETå±æ€§ç­›é€‰ï¼‰**ï¼š
   - **é€»è¾‘**ï¼šæ£€æŸ¥ç±»è¯æ€§ï¼ˆLipinski è§„åˆ™ï¼‰ã€‚
   - **ç»“æœ**ï¼šæœ€åè¾“å‡ºå‰ 10 ä¸ªâ€œé«˜æ½œåŠ›â€åˆ†å­ï¼ˆLead Compoundsï¼‰ã€‚

------

## 2. ä¸ºä»€ä¹ˆéœ€è¦â€œä¸¤ä¸ªæ¨¡å‹â€åŒæ—¶è¿è¡Œï¼Ÿ

è¯ç‰©ç­›é€‰ä¸æ˜¯åªçœ‹â€œå¥½ä¸å¥½ä½¿â€ï¼Œè¿˜è¦çœ‹â€œèƒ½ä¸èƒ½åƒâ€ã€‚è¿™å°±æ˜¯ **å¤šç›®æ ‡ä¼˜åŒ–ï¼ˆMulti-parameter Optimizationï¼‰**ã€‚

åœ¨ä½ çš„ç³»ç»Ÿä¸­ï¼Œè¿™ä¸¤ä¸ªæ¨¡å‹æ„æˆäº†**å¤åˆå†³ç­–é“¾**ï¼š

| **æ¨¡å‹ä»»åŠ¡**    | **ç­›é€‰ç›®çš„**   | **ç­›é€‰é€»è¾‘**                                                 |
| --------------- | -------------- | ------------------------------------------------------------ |
| **ESOL (å›å½’)** | **ç”Ÿç‰©åˆ©ç”¨åº¦** | å¦‚æœé¢„æµ‹å€¼æä½ï¼Œè¯´æ˜è¯¥åˆ†å­å³ä¾¿è¯æ•ˆå†å¥½ä¹Ÿæ— æ³•åœ¨äººä½“å†…å¾ªç¯ï¼Œç›´æ¥**Passæ‰**ã€‚ |
| **BBBP (åˆ†ç±»)** | **é¶å‘å‡†ç¡®æ€§** | å¯¹äºä¸­æ¢ç¥ç»è¯ç‰©ï¼Œå¦‚æœé¢„æµ‹ç»“æœä¸º `0`ï¼ˆä¸ç©¿é€ï¼‰ï¼Œè¯´æ˜å®ƒæ— æ³•åˆ°è¾¾ç—…ç¶ï¼Œç›´æ¥**Passæ‰**ã€‚ |

**ç­›é€‰ç»“è®º**ï¼šåªæœ‰å½“ä¸€ä¸ªåˆ†å­åœ¨ `ESOL` é¢„æµ‹ä¸­è¡¨ç°å¹³åº¸ä»¥ä¸Šï¼Œä¸”åœ¨ `BBBP` ä¸­é¢„æµ‹ä¸º `1` æ—¶ï¼Œå®ƒæ‰ä¼šå‡ºç°åœ¨ä½  Web ç•Œé¢çš„â€œæ¨èåˆ—è¡¨â€ä¸­ã€‚

------

## 3. ç­›é€‰ç³»ç»Ÿçš„â€œä»£ç åŒ–â€å®ç°é€»è¾‘

å½“ä½ åœ¨ Web ç•Œé¢ç‚¹å‡»"æ‰¹é‡ç­›é€‰"ï¼Œç³»ç»Ÿåå°çš„å®é™…æ‰§è¡Œé€»è¾‘ï¼š

```python
# çœŸå®ä»£ç ï¼šinference/predictor.py ä¸­çš„ DrugScreener ç±»
class DrugScreener:
    def screen_library(self, smiles_list, top_k=10, ascending=False):
        """æ‰¹é‡ç­›é€‰åˆ†å­åº“"""
        results = []
        
        for smiles in smiles_list:
            try:
                # 1. ç‰¹å¾æå– (ECFPæŒ‡çº¹)
                features = self.featurizer.get_morgan_fingerprint(smiles)
                features_tensor = torch.FloatTensor(features).unsqueeze(0)
                
                # 2. GPUåŠ é€Ÿé¢„æµ‹
                with torch.no_grad():
                    logits = self.model(features_tensor.to(self.device))
                    score = torch.sigmoid(logits).cpu().item()
                
                # 3. è®°å½•ç»“æœ
                results.append({
                    'smiles': smiles,
                    'score': score,
                    'prediction': 'Yes' if score > 0.5 else 'No'
                })
            except:
                continue  # è·³è¿‡æ— æ•ˆåˆ†å­
        
        # 4. è½¬ä¸ºDataFrameå¹¶æ’åº
        df = pd.DataFrame(results)
        df = df.sort_values('score', ascending=ascending)
        
        # 5. è¿”å›Top-Kå€™é€‰
        return df.head(top_k)
    
    def filter_by_lipinski(self, df):
        """åº”ç”¨Lipinskiç±»è¯æ€§è§„åˆ™"""
        valid_drugs = []
        
        for _, row in df.iterrows():
            mol = Chem.MolFromSmiles(row['smiles'])
            if mol is None:
                continue
            
            # è®¡ç®—è¯ç‰©æ€§è´¨
            mw = Descriptors.MolWt(mol)
            logp = Descriptors.MolLogP(mol)
            hbd = Descriptors.NumHDonors(mol)
            hba = Descriptors.NumHAcceptors(mol)
            
            # Lipinskiè§„åˆ™æ£€æŸ¥
            if (mw <= 500 and logp <= 5 and 
                hbd <= 5 and hba <= 10):
                valid_drugs.append(row)
        
        return pd.DataFrame(valid_drugs)
```

**å®é™…åº”ç”¨ç¤ºä¾‹**:

```python
# ç”¨æˆ·ä¸Šä¼ åŒ…å«924ä¸ªåˆ†å­çš„drug_library_1500.csv
screener = DrugScreener(predictor)
results = screener.screen_library(
    smiles_list=df['smiles'].tolist(),
    top_k=10,
    ascending=False  # åˆ†æ•°è¶Šé«˜è¶Šå¥½
)

# åº”ç”¨Lipinskiè¿‡æ»¤
filtered_results = screener.filter_by_lipinski(results)

# è¾“å‡ºTop-10å€™é€‰è¯ç‰©
print(filtered_results)
#    smiles                          score  prediction  MW    LogP
# 0  CC(=O)OC1=CC=CC=C1C(=O)O       0.9876  Yes        180   1.19
# 1  CN1C=NC2=C1C(=O)N(C(=O)N2C)C   0.9654  Yes        194   -0.07
# ...
# ä¼ªä»£ç ï¼šæ­ç¤ºâ€œç­›é€‰â€å¦‚ä½•å‘ç”Ÿ
candidates = load_large_library("unseen_molecules.csv") # åŠ è½½1ä¸‡ä¸ªæœªçŸ¥åˆ†å­
hit_list = []

for mol in candidates:
    # 1. ç‰¹å¾æå– (Morgan Fingerprint)
    features = featurizer.extract(mol)
    
    # 2. æ¨¡å‹ A è¿‡æ»¤ (æº¶è§£åº¦)
    solubility = esol_model.predict(features)
    if solubility < MIN_THRESHOLD: 
        continue # ç­›æ‰ï¼ä¸æº¶äºæ°´çš„ä¸è¦
        
    # 3. æ¨¡å‹ B è¿‡æ»¤ (è¡€è„‘å±éšœ)
    prob_bbb = bbbp_model.predict(features)
    if prob_bbb < 0.8:
        continue # ç­›æ‰ï¼è¿›ä¸äº†å¤§è„‘çš„ä¸è¦
        
    # 4. åªæœ‰è¿‡äº”å…³æ–©å…­å°†çš„æ‰åŠ å…¥ Hit List
    hit_list.append({ "smiles": mol, "score": prob_bbb })

# 5. æ’åºï¼ˆçœŸæ­£çš„ç­›é€‰ç»“æœï¼‰
final_ranking = sorted(hit_list, key=lambda x: x['score'], reverse=True)
return final_ranking[:10] # åªç»™ç”¨æˆ·çœ‹æœ€å¼ºçš„10ä¸ª
```

------

## 4. Web ç•Œé¢å¦‚ä½•ä½“ç°â€œç­›é€‰â€ï¼Ÿ

åœ¨ä½ çš„ `web/app.py` ä¸­ï¼Œè™½ç„¶ç›®å‰æ˜¯å•åˆ†å­è¾“å…¥ï¼Œä½†å®ƒä½“ç°äº†ç­›é€‰çš„æ ¸å¿ƒåé¦ˆï¼š

- **ä¸ä»…ä»…ç»™å‡ºç»“æœ**ï¼šå®ƒåŒæ—¶å±•ç¤ºäº†åˆ†å­é‡ã€LogPï¼ˆè„‚æ°´åˆ†é…ç³»æ•°ï¼‰ã€TPSAï¼ˆææ€§è¡¨é¢ç§¯ï¼‰ã€‚
- **ç±»è¯æ€§è¯„ä»·**ï¼šå®ƒé€šè¿‡ **Lipinski's Rule of Five** å‘Šè¯‰ä½ è¿™ä¸ªåˆ†å­æ˜¯å¦åƒä¸€ä¸ªè¯ã€‚
- **å†³ç­–æ”¯æŒ**ï¼šå¦‚æœé¢„æµ‹ç»“æœæ˜¯â€œç©¿é€è¡€è„‘å±éšœâ€ï¼Œä¸”ç¬¦åˆæ‰€æœ‰ç±»è¯æ€§è§„åˆ™ï¼Œç³»ç»Ÿä¼šæ ‡è®°ä¸€ä¸ª**â€œğŸ‰ ç¬¦åˆç±»è¯æ€§è§„åˆ™ï¼â€**ã€‚è¿™æœ¬è´¨ä¸Šæ˜¯åœ¨å‘Šè¯‰ç§‘ç ”äººå‘˜ï¼šâ€œè¿™ä¸ªåˆ†å­å€¼å¾—ä½ å»å®éªŒå®¤åˆæˆå®ƒã€‚â€

------

